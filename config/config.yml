# BGPalerter v2 Configuration File - Repaired for AS58173
configVersion: 2
environment: production

# Data sources for BGP updates
connectors:
  - file: connectorRIS
    name: ris
    params:
      url: ws://ris-live.ripe.net/v1/ws/
      perMessageDeflate: true
      carefulSubscription: true
      includeRaw: false
      subscription:
        type: UPDATE
        moreSpecific: true

# Monitoring modules
monitors:
  - file: monitorHijack
    channel: hijack
    name: basic-hijack-detection
    params:
      thresholdMinPeers: 3

  - file: monitorNewPrefix
    channel: newprefix
    name: new-prefix-detection
    params:
      thresholdMinPeers: 3

  - file: monitorVisibility
    channel: visibility
    name: withdrawal-detection
    params:
      thresholdMinPeers: 40

  - file: monitorPath
    channel: path
    name: path-matching
    params:
      thresholdMinPeers: 1

  # ASN monitor implemented by monitorAS; keep channel aligned with reports.
  - file: monitorAS
    channel: misconfiguration
    name: asn-monitor
    params:
      thresholdMinPeers: 3
      skipPrefixMatch: false

  - file: monitorRPKI
    channel: rpki
    name: rpki-monitor
    params:
      thresholdMinPeers: 3
      checkUncovered: false
      checkDisappearing: false
  - file: monitorPathNeighbors
    channel: path
    name: path-neighbors
    params:
      thresholdMinPeers: 3

# Reporting modules
reports:
  - file: reportFile
    channels:
      - hijack
      - newprefix
      - visibility
      - path
      - misconfiguration
      - rpki
    params:
      persistAlertData: false
      alertDataDirectory: /opt/bgpalerter/alertdata/

  - file: reportEmail
    channels:
      - hijack
      - newprefix
      - visibility
      - path
      - misconfiguration
      - rpki
    params:
      senderEmail: bgpalerter.com
      smtp:
        host: onwave-com.mail.protection.outlook.com
        port: 25
        secure: false
      notifiedEmails:
        default:
          - iain.murdoch.com

  - file: reportSyslog
    channels:
      - hijack
      - newprefix
      - visibility
      - path
      - misconfiguration
      - rpki
    params:
      host: 172.30.250.34
      port: 514
      transport: udp
      templates:
        default: '++BGPalerter-3-: ||'
        hijack: '++BGPalerter-5-: ||||||||'
        newprefix: '++BGPalerter-4-: ||||||||'
        visibility: '++BGPalerter-5-: ||||||'
        misconfiguration: '++BGPalerter-3-: ||||'
        rpki: '++BGPalerter-3-: |||||'

monitoredPrefixesFiles:
  - /opt/bgpalerter/prefixes.yml

groupsFile: /opt/bgpalerter/groups.yml

# RPKI validation settings
rpki:
  vrpProvider: rpkiclient
  refreshVrpListMinutes: 15
  markDataAsStaleAfterMinutes: 120

# REST API for health checks
rest:
  host: 0.0.0.0
  port: 8011

# Process monitoring for health checks
processMonitors:
  - file: uptimeApi
    params:
      useStatusCodes: true

# Logging settings
logging:
  directory: /opt/bgpalerter/logs
  logRotatePattern: YYYY-MM-DD
  maxRetainedFiles: 10
  maxFileSizeMB: 15
  compressOnRotation: false
  useUTC: true

notificationIntervalSeconds: 86400
persistStatus: true
checkForUpdatesAtBoot: true
